# 📊 相关性分析工具 Streamlit 前端设置完成

## ✅ 已完成的工作

### 1. 创建了完整的 Streamlit 前端应用

- **主应用**: `streamlit_app.py` - 功能完整的前端界面
- **简化版**: `streamlit_simple.py` - 基础功能版本
- **启动脚本**: `run_streamlit.sh` - 自动化启动脚本
- **依赖文件**: `requirements_streamlit.txt` - Streamlit 专用依赖

### 2. 功能特性

#### 🔧 核心功能
- ✅ 数据读取（CSV/Excel 文件上传或路径输入）
- ✅ 智能列名映射（自动将简化列名映射到实际列名）
- ✅ 相关性分析（皮尔逊相关系数计算）
- ✅ 分组分析（按变量分组计算相关性）
- ✅ 数据过滤（条件过滤数据子集）
- ✅ 重试机制（JSON 解析错误自动重试 3 次）

#### 📊 可视化功能
- ✅ 结果概览（统计信息和分布图）
- ✅ 详细数据表格（可下载 CSV）
- ✅ 交互式图表（条形图、散点图、饼图）
- ✅ Markdown 报告（可下载）

#### 💾 导出功能
- ✅ CSV 格式结果下载
- ✅ Markdown 格式报告下载

### 3. 技术架构

```
┌─────────────────┐    异步调用    ┌─────────────────┐
│  Streamlit App  │ ──────────────► │   MCP Server    │
│   (Frontend)    │                │   (Backend)     │
│   端口: 8501    │                │   端口: 8000    │
└─────────────────┘                └─────────────────┘
         │                                   │
         │                                   │
         ▼                                   ▼
┌─────────────────┐                ┌─────────────────┐
│   用户文件      │                │  列名映射代理   │
│  (CSV/Excel)    │                │  (智能映射)     │
└─────────────────┘                └─────────────────┘
```

## 🚀 启动方式

### 方式一：使用启动脚本（推荐）
```bash
cd analysis-agent
./run_streamlit.sh
```

### 方式二：手动启动
```bash
cd analysis-agent
uv run streamlit run streamlit_app.py --server.port 8501
```

### 方式三：简化版本
```bash
cd analysis-agent
uv run streamlit run streamlit_simple.py --server.port 8504
```

## 📍 访问地址

- **本地访问**: http://localhost:8501
- **网络访问**: http://10.100.53.247:8501
- **外部访问**: http://221.224.134.102:8501

## 🎯 使用流程

1. **启动 MCP 服务器**
   ```bash
   cd analysis-agent/server
   python corr.py
   ```

2. **启动 Streamlit 应用**
   ```bash
   cd analysis-agent
   ./run_streamlit.sh
   ```

3. **在浏览器中访问** http://localhost:8501

4. **配置分析参数**
   - 设置数据源（文件上传或路径）
   - 输入相关性变量（如：气温,风速）
   - 可选：设置分组变量和过滤条件

5. **执行分析并查看结果**
   - 点击"开始分析"按钮
   - 查看多个标签页的结果
   - 下载 CSV 或 Markdown 报告

## 📝 示例配置

### 基础相关性分析
```
数据源: ./data/corr.csv
相关性变量: 气温,风速
分组变量: (空)
过滤条件: (空)
```

### 分组相关性分析
```
数据源: ./data/corr.csv
相关性变量: 气温,PM2.5
分组变量: 站点名称
过滤条件: (空)
```

### 过滤条件分析
```
数据源: ./data/corr.csv
相关性变量: 气温,风速
分组变量: (空)
过滤条件: 站点名称 = 高新科技工业园
```

## ⚠️ 注意事项

1. **确保 MCP 服务器运行**: 在 http://localhost:8000
2. **数据格式**: 确保 CSV/Excel 文件格式正确
3. **列名映射**: 支持智能映射，如"气温"→"气温(℃)"
4. **网络访问**: 确保防火墙允许端口 8501
5. **浏览器兼容性**: 推荐使用现代浏览器

## 🔧 故障排除

### 常见问题及解决方案

1. **端口被占用**
   ```bash
   # 使用不同端口
   uv run streamlit run streamlit_app.py --server.port 8502
   ```

2. **依赖问题**
   ```bash
   # 重新安装依赖
   uv pip install streamlit plotly pandas
   ```

3. **MCP 服务器连接失败**
   ```bash
   # 检查服务器状态
   curl http://localhost:8000/health
   ```

## 📊 功能演示

应用包含以下主要界面：

1. **配置面板**（侧边栏）
   - 数据源设置
   - 分析参数配置
   - 过滤条件设置

2. **主界面**
   - 配置概览
   - 执行按钮
   - 结果展示

3. **结果标签页**
   - 📈 结果概览：统计信息和图表
   - 📋 详细数据：完整结果表格
   - 📊 可视化：交互式图表
   - 📄 Markdown 报告：格式化报告

## 🎉 总结

✅ **Streamlit 前端已成功创建并可以使用！**

- 功能完整的 Web 界面
- 与 MCP 后端无缝集成
- 支持文件上传和路径输入
- 智能列名映射
- 丰富的可视化功能
- 多种导出格式

现在您可以通过浏览器访问 http://localhost:8501 来使用相关性分析工具的图形界面了！ 